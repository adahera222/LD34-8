<!DOCTYPE HTML>
<!DOCTYPE HTML>
<html>
  <head>
    <script type="text/javascript" src = "js/game.js"></script>
    <script type="text/javascript" src = "js/math2D.js"></script>
    <script type="text/javascript" src = "js/drawing.js"></script>
    <script type="text/javascript" src = "js/colors.js"></script>
    <script type="text/javascript" src = "js/utility.js"></script>
    <script type="text/javascript" src = "js/mouse.js"></script>
    <script type="text/javascript" src = "js/keyboard.js"></script>
    <script type="text/javascript" src = "js/gameobject.js"></script>
    <script type="text/javascript" src = "js/levels.js"></script>
    <title>New Game</title>
  </head>
  
  <body>
    <canvas id="game_canvas" style="border:1px solid black; position: absolute; left:0; top:0;"></canvas>
  </body>
  
  
  <script type="text/javascript" src="tracks.js"></script>
  <script type="text/javascript" src="trains.js"></script>
  
  
  <script type="text/javascript">
    // The game
    var game = new Game({bg_color:'#0a492c'});
    game.setTitle("Loops!");
    game.setSize(xy(800, 600));
    enableLevels(game);
    window.onload = function() {
      game.bringToFront('circular');
      game.bringToFront('train');
      game.start();
    }
    
    game.bringToFront = function(type) {
      // loop backwards so we don't skip items
      for (var i = this.objects.length - 1; i >= 0; i--) {
        if (!this.objects[i].type || this.objects[i].type !== type) continue;
        this.objects.push(this.objects.splice(i, 1)[0]);
      }
    }
    
    
    game.next_track = 0;
    game.tracks = [];
    
    // Temporary button to move to next level
    var next_level = new GameObject(game);
    next_level.p1 = xy(30, 20);
    next_level.p2 = xy(120, 40),
    next_level.draw = function() {
      rect(this.ctx, this.p1, this.p2, 'black');
      game.setFont(game.display.font_small);
      text(this.ctx, "Skip to next level", this.p1, "nw");
    }
    next_level.contains = function(pos) { return isBetweenCoords(pos, this.p1, this.p2) }
    next_level.onclick = function() { console.log('next level!'); game.doNextLevel(); }
    
    // ========== SETTINGS
    // Display constants
    game.display.track_width = 8; // px
    game.display.track_color = 'white';
    game.display.train_radius = 12; // px
    game.display.darkened_track_extent = 0.4;
    
    game.display.font_title = {size: 48, type: 'Arial'}
    game.display.font_large = {size: 36, type: 'Arial'}
    game.display.font_normal = {size: 24, type: 'Arial'}
    game.display.font_small = {size: 12, type: 'Arial'}
    
    game.ctx.fillStyle = 'white'; // default foreground color
    game.ctx.strokeStyle = 'white';
    
    // Other constants
    game.train_speed = 3; // pixels per frame. TODO: convert to pixels per second
    game.joint_click_radius = 20; // radius of area in which you can click the joining of two tracks
    
    
    // ========== GAME STAGES
    game.titlescreen = function() {
      clear(this.ctx);
      this.setFont(this.display.font_title);
      text(this.ctx, this.title, xy(400, 200), "centered");
      this.setFont(this.display.font_normal);
      setTimeout(function() { game.doNextLevel(); game.stage = game.gameplay; game.next(); }, 1*1000);
    }
    game.gameplay = function() {
      clear(this.ctx);
      if (this.isKeyPressed("L")) {}
      iter(this.objects, function(obj) { obj.tick(); });
      iter(this.objects, function(obj) { obj.draw(); });
      this.next();
    }
    
    
    game.stage = game.titlescreen; // default stages
    
  </script>
  
  <script type="text/javascript" src="levels/start.js"></script>
  <script type="text/javascript" src="levels/level1.js"></script>
  <script type="text/javascript" src="levels/level2.js"></script>
  <script type="text/javascript" src="levels/level3.js"></script>
  <script type="text/javascript" src="levels/level4.js"></script>
  <script type="text/javascript" src="levels/level5.js"></script>
  <script type="text/javascript" src="levels/level6.js"></script>
  <script type="text/javascript" src="levels/level7.js"></script>
  <script type="text/javascript" src="levels/level8.js"></script>
  <script type="text/javascript" src="levels/level9.js"></script>
  <script type="text/javascript" src="levels/level10.js"></script>
  
</html>
